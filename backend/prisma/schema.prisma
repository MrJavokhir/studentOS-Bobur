// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// =============================================================================
// ENUMS
// =============================================================================

enum UserRole {
  STUDENT
  EMPLOYER
  ADMIN
}

enum EducationLevel {
  HIGHSCHOOL
  UNDERGRADUATE
  POSTGRADUATE
  BOOTCAMP
  SELF_TAUGHT
}

enum LocationType {
  REMOTE
  HYBRID
  ONSITE
}

enum ApplicationStatus {
  NEW
  SCREENING
  INTERVIEW
  OFFER
  REJECTED
  WITHDRAWN
}

enum JobStatus {
  ACTIVE
  PAUSED
  CLOSED
}

enum BlogStatus {
  DRAFT
  PUBLISHED
}

enum SubscriptionStatus {
  ACTIVE
  CANCELLED
  EXPIRED
}

enum PlanInterval {
  MONTHLY
  YEARLY
}

// =============================================================================
// USER & PROFILES
// =============================================================================

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  passwordHash  String?
  role          UserRole  @default(STUDENT)
  isActive      Boolean   @default(true)
  emailVerified Boolean   @default(false)
  googleId      String?   @unique
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  lastLoginAt   DateTime?

  // Relations
  studentProfile   StudentProfile?
  employerProfile  EmployerProfile?
  refreshTokens    RefreshToken[]
  habits           Habit[]
  habitLogs        HabitLog[]
  jobApplications  JobApplication[]
  savedScholarships SavedScholarship[]
  savedJobs        SavedJob[]
  blogPosts        BlogPost[]
  communityPosts   CommunityPost[]
  comments         Comment[]
  likes            Like[]
  subscription     Subscription?
  contactMessages  ContactMessage[]

  @@index([email])
  @@index([googleId])
}

model StudentProfile {
  id              String          @id @default(cuid())
  userId          String          @unique
  user            User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  fullName        String?
  avatarUrl       String?
  bio             String?
  educationLevel  EducationLevel?
  university      String?
  graduationYear  Int?
  major           String?
  country         String?
  goals           String[]        @default([])
  skills          String[]        @default([])
  cvUrl           String?
  atsScore        Int?            @default(0)
  profileCompletion Int           @default(0)
  
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
}

model EmployerProfile {
  id            String   @id @default(cuid())
  userId        String   @unique
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  companyName   String
  tagline       String?
  description   String?
  industry      String?
  companySize   String?
  logoUrl       String?
  website       String?
  linkedIn      String?
  address       String?
  city          String?
  state         String?
  country       String?
  
  jobs          Job[]
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model RefreshToken {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  expiresAt DateTime
  createdAt DateTime @default(now())
  
  @@index([token])
  @@index([userId])
}

// =============================================================================
// SCHOLARSHIPS
// =============================================================================

model Scholarship {
  id              String   @id @default(cuid())
  title           String
  institution     String
  country         String
  studyLevel      String
  awardType       String
  awardAmount     String?
  deadline        DateTime?
  description     String?
  applicationUrl  String?
  imageUrl        String?
  isActive        Boolean  @default(true)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  savedBy         SavedScholarship[]
  
  @@index([country])
  @@index([studyLevel])
  @@index([isActive])
}

model SavedScholarship {
  id            String      @id @default(cuid())
  userId        String
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  scholarshipId String
  scholarship   Scholarship @relation(fields: [scholarshipId], references: [id], onDelete: Cascade)
  savedAt       DateTime    @default(now())
  
  @@unique([userId, scholarshipId])
  @@index([userId])
}

// =============================================================================
// JOBS & APPLICATIONS
// =============================================================================

model Job {
  id               String       @id @default(cuid())
  title            String
  company          String
  location         String?
  locationType     LocationType @default(ONSITE)
  salaryMin        Int?
  salaryMax        Int?
  salaryType       String?      @default("yearly")
  department       String?
  description      String?
  requirements     String[]     @default([])
  responsibilities String[]     @default([])
  benefits         String[]     @default([])
  status           JobStatus    @default(ACTIVE)
  
  employerId       String
  employer         EmployerProfile @relation(fields: [employerId], references: [id], onDelete: Cascade)
  
  postedAt         DateTime     @default(now())
  expiresAt        DateTime?
  updatedAt        DateTime     @updatedAt
  
  applications     JobApplication[]
  savedBy          SavedJob[]
  
  @@index([status])
  @@index([locationType])
  @@index([employerId])
}

model JobApplication {
  id          String            @id @default(cuid())
  jobId       String
  job         Job               @relation(fields: [jobId], references: [id], onDelete: Cascade)
  userId      String
  user        User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  status      ApplicationStatus @default(NEW)
  coverLetter String?
  cvUrl       String?
  matchScore  Int?
  notes       String?
  
  appliedAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  
  @@unique([jobId, userId])
  @@index([userId])
  @@index([jobId])
  @@index([status])
}

model SavedJob {
  id      String   @id @default(cuid())
  userId  String
  user    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  jobId   String
  job     Job      @relation(fields: [jobId], references: [id], onDelete: Cascade)
  savedAt DateTime @default(now())
  
  @@unique([userId, jobId])
  @@index([userId])
}

// =============================================================================
// HABITS
// =============================================================================

model Habit {
  id        String     @id @default(cuid())
  userId    String
  user      User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  title     String
  icon      String?
  color     String?
  frequency String     @default("daily")
  isActive  Boolean    @default(true)
  
  logs      HabitLog[]
  
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  
  @@index([userId])
}

model HabitLog {
  id          String   @id @default(cuid())
  habitId     String
  habit       Habit    @relation(fields: [habitId], references: [id], onDelete: Cascade)
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  completedAt DateTime @default(now())
  notes       String?
  
  @@index([habitId])
  @@index([userId])
  @@index([completedAt])
}

// =============================================================================
// BLOG
// =============================================================================

model BlogPost {
  id            String     @id @default(cuid())
  title         String
  slug          String     @unique
  content       String
  excerpt       String?
  coverImageUrl String?
  authorId      String
  author        User       @relation(fields: [authorId], references: [id], onDelete: Cascade)
  status        BlogStatus @default(DRAFT)
  tags          String[]   @default([])
  
  publishedAt   DateTime?
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  
  @@index([slug])
  @@index([status])
  @@index([authorId])
}

// =============================================================================
// COMMUNITY
// =============================================================================

model CommunityPost {
  id        String    @id @default(cuid())
  userId    String
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  content   String
  imageUrl  String?
  
  comments  Comment[]
  likes     Like[]
  
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  
  @@index([userId])
}

model Comment {
  id        String        @id @default(cuid())
  postId    String
  post      CommunityPost @relation(fields: [postId], references: [id], onDelete: Cascade)
  userId    String
  user      User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  content   String
  
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  
  @@index([postId])
  @@index([userId])
}

model Like {
  id        String        @id @default(cuid())
  postId    String
  post      CommunityPost @relation(fields: [postId], references: [id], onDelete: Cascade)
  userId    String
  user      User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime      @default(now())
  
  @@unique([postId, userId])
  @@index([postId])
}

// =============================================================================
// PRICING & SUBSCRIPTIONS
// =============================================================================

model PricingPlan {
  id            String         @id @default(cuid())
  name          String
  description   String?
  price         Float
  interval      PlanInterval   @default(MONTHLY)
  features      String[]       @default([])
  isActive      Boolean        @default(true)
  isPopular     Boolean        @default(false)
  
  subscriptions Subscription[]
  
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
}

model Subscription {
  id        String             @id @default(cuid())
  userId    String             @unique
  user      User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  planId    String
  plan      PricingPlan        @relation(fields: [planId], references: [id])
  status    SubscriptionStatus @default(ACTIVE)
  
  startDate DateTime           @default(now())
  endDate   DateTime?
  
  createdAt DateTime           @default(now())
  updatedAt DateTime           @updatedAt
  
  @@index([userId])
  @@index([planId])
}

// =============================================================================
// CONTACT
// =============================================================================

model ContactMessage {
  id        String   @id @default(cuid())
  name      String
  email     String
  subject   String?
  message   String
  isRead    Boolean  @default(false)
  userId    String?
  user      User?    @relation(fields: [userId], references: [id], onDelete: SetNull)
  
  createdAt DateTime @default(now())
  
  @@index([isRead])
}
